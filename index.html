<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Graha Pravesh â€¢ Dark Experience</title>
  <meta name="description" content="Dark, Apple/Tesla-inspired scroll experience for Graha Pravesh with CSS art, sound on Aarti, and scroll-driven 3D cube." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b0d; --bg-2:#0f0f14; --ink:#e7e7eb; --muted:#a7a7b1;
      --violet:#c084fc; --cyan:#22d3ee; --saffron:#f59e0b; --rose:#fb7185;
      --card:#121217cc; --line:#1d1d23; --radius:22px; --shadow:0 10px 30px rgba(0,0,0,.45);
      --H: 92svh; --steps: 7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:
        radial-gradient(1200px 800px at 20% -10%, rgba(124,58,237,.08), transparent 60%),
        radial-gradient(1200px 800px at 80% 120%, rgba(34,211,238,.06), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg-2));
      overflow-x:hidden;
    }

    section{min-height:100svh; display:grid; place-items:center; position:relative; padding:80px 24px}
    .inner{width:min(1200px,92vw)}

    .card{ background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius); backdrop-filter:blur(12px); box-shadow:var(--shadow) }
    .pad{ padding:24px }

    /* side nav on RIGHT */
    .nav{ position:fixed; right:24px; top:50%; transform:translateY(-50%); display:flex; flex-direction:column; gap:12px; z-index:50 }
    .dot{ width:10px; height:10px; border-radius:999px; background:#2a2a32; border:1px solid #353542; box-shadow:inset 0 0 0 2px #0c0c10 }
    .dot.active{ background:linear-gradient(135deg, var(--violet), var(--cyan)); box-shadow:0 0 0 6px rgba(192,132,252,.18) }

    /* HERO */
    .hero{ overflow:hidden; }
    .halo{ position:absolute; inset:-20%; background:conic-gradient(from 0deg, #0000 0 30%, rgba(192,132,252,.12) 40%, #0000 55% 100%);
           filter:blur(80px); opacity:.9; pointer-events:none }
    .grid{ position:absolute; inset:0; background:
      linear-gradient(#ffffff08 1px, transparent 1px) 0 0 / 24px 24px,
      linear-gradient(90deg, #ffffff08 1px, transparent 1px) 0 0 / 24px 24px; mask:radial-gradient(60% 50% at 50% 50%, #000 60%, transparent 70%) }

    .hero h1{ font-family:"Playfair Display",serif; font-size:clamp(40px,7vw,84px); margin:0; letter-spacing:.4px }
    .sub{ color:var(--muted); margin:10px 0 0 0 }

    .ganesha{ width:min(560px,80vw); aspect-ratio:1/1; display:block; margin:0 auto; }
    .ganesha path{ stroke:url(#gstroke); stroke-width:2.4; fill:none; stroke-linecap:round; filter:drop-shadow(0 0 12px rgba(192,132,252,.18)) }

    .meta{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px }
    .chip{ border:1px solid #2a2a36; border-radius:999px; padding:8px 12px; background:#0f0f14 }

    .scrollhint{ position:absolute; bottom:18px; left:50%; transform:translateX(-50%); color:#8f8fa3; font-size:12px; letter-spacing:.12em; text-transform:uppercase }
    .scrollhint::after{ content:""; display:block; height:1px; width:80px; margin:8px auto 0; background:linear-gradient(90deg,transparent,#8f8fa3,transparent) }

    /* STICKY STAGE */
    .stage{ height:calc(var(--H) * var(--steps)); }
    .pin{ position:sticky; top:4svh; height:var(--H); display:grid; place-items:center; perspective:1600px; z-index:2 }

    /* backdrop image outside the cube */
    .stage-bg{
      position:absolute; inset:-6% 0 -6% 0; z-index:0; pointer-events:none; overflow:hidden;
      mask: radial-gradient(80% 60% at 50% 45%, #000 60%, transparent 100%);
    }
    .stage-bg img{
      position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
      opacity:.18; transform: scale(1.08);
      transition: opacity .6s ease, transform 1.2s ease;
      filter: saturate(1.1) contrast(1.06) blur(.5px);
    }
    .stage-bg img.fade{ opacity:0; transform: scale(1.02); }

    /* rangoli floor */
    .floor-wrap{ position:absolute; inset:0; display:grid; place-items:center; pointer-events:none; z-index:1; }
    .floor{
      width:140vmin; height:140vmin; border-radius:50%;
      background:
        conic-gradient(from 0deg, rgba(197,137,255,.25), rgba(34,211,238,.0) 30%, rgba(255,179,71,.25) 60%, rgba(34,211,238,.0) 100%),
        repeating-conic-gradient(from 0deg, rgba(255,255,255,.06) 0 3deg, rgba(0,0,0,0) 3deg 6deg),
        radial-gradient(closest-side, rgba(255,255,255,.06), transparent 70%);
      transform: translateZ(0) rotateX(65deg) scale(1.1);
      box-shadow: 0 40px 120px rgba(0,0,0,.45) inset, 0 10px 60px rgba(0,0,0,.35);
      opacity:.45; animation: breathe 6s ease-in-out infinite;
    }
    @keyframes breathe{ 0%,100%{ transform: translateZ(0) rotateX(65deg) scale(1.08) } 50%{ transform: translateZ(0) rotateX(65deg) scale(1.14) } }

    /* particle confetti */
    .particles{ position:absolute; inset:-10%; z-index:1; opacity:0; transition: opacity .8s ease; pointer-events:none }
    .particles.show{ opacity:.8 }

    /* cube */
    .cube{ position:relative; width:min(800px,90vw); aspect-ratio:1/1; transform-style:preserve-3d; transform: rotateX(var(--rx, -12deg)) rotateY(var(--ry, 20deg)) translateZ(0); transition:transform .8s cubic-bezier(.2,.8,.2,1); z-index:2 }
    .face{ position:absolute; inset:0; display:grid; place-items:center; border-radius:20px; background:linear-gradient(180deg, #15151b, #0f0f14); border:1px solid #262632; box-shadow:var(--shadow); overflow:hidden }
    .face::before{ content:""; position:absolute; inset:0; background:linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent); opacity:.2 }
    .face .content{ position:relative; z-index:2; display:grid; gap:10px; place-items:center; text-align:center; padding:20px }
    .face h3{ margin:0; font-size:clamp(20px,2.4vw,28px); position:relative; overflow:hidden }
    .face h3::after{
      content:""; position:absolute; inset:-200% -50%; background:
        radial-gradient(260px 160px at var(--sx, -40%) 50%, rgba(192,132,252,.22), rgba(34,211,238,.0) 60%);
      animation: sweep 3.8s linear infinite; mix-blend-mode:screen; pointer-events:none;
    }
    @keyframes sweep{ 0%{ --sx:-40%; opacity:.0 } 12%{ opacity:.9 } 50%{ --sx:140%; opacity:.4 } 100%{ --sx:140%; opacity:0 } }
    .face p{ margin:0; color:var(--muted) }

    /* art block with photo + icon svg above */
    .art{ width:min(360px,60%); aspect-ratio:1/1; border-radius:16px; position:relative; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.35); background:#0f0f14; isolation:isolate }
    .photo{
      position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
      opacity:.9; filter: saturate(1.15) contrast(1.05) brightness(.95);
      transform: scale(1.03);
    }
    .art::after{ content:""; position:absolute; inset:-30%;
      background:radial-gradient(circle at 30% 30%, rgba(192,132,252,.18), transparent 40%), radial-gradient(circle at 70% 70%, rgba(34,211,238,.18), transparent 40%);
      filter:blur(20px); z-index:0 }
    .art svg{ position:absolute; inset:10% 10% auto; width:80%; height:80%; z-index:1; }

    /* face positions */
    .front{ transform: translateZ(400px) }
    .back{ transform: rotateY(180deg) translateZ(400px) }
    .right{ transform: rotateY(90deg) translateZ(400px) }
    .left{ transform: rotateY(-90deg) translateZ(400px) }
    .top{ transform: rotateX(90deg) translateZ(400px) }
    .bottom{ transform: rotateX(-90deg) translateZ(400px) }

    .step{ height:var(--H); display:grid; place-items:center; position:relative; z-index:1 }
    .reveal{ opacity:0; transform:translateY(16px) scale(.98); transition:opacity .6s ease, transform .6s ease }
    .reveal.show{ opacity:1; transform:none }
    .footer{ text-align:center; color:#6e6e78; padding:40px 12px 80px }
    .btn{ font-weight:700; padding:12px 16px; border-radius:12px; border:1px solid #2a2a36; background:#12121a; color:#e7e7eb; cursor:pointer }
    .btn:hover{ border-color:#3a3a46 }
  </style>
</head>
<body>
  <nav class="nav" aria-label="Section navigation">
    <a class="dot active" href="#hero" aria-label="Hero"></a>
    <a class="dot" href="#stage" aria-label="Highlights"></a>
    <a class="dot" href="#venue" aria-label="Venue"></a>
    <a class="dot" href="#details" aria-label="Details"></a>
  </nav>

  <!-- HERO -->
  <section class="hero" id="hero">
    <div class="halo"></div>
    <div class="grid"></div>
    <div class="inner">
      <svg class="ganesha" viewBox="0 0 512 512" role="img" aria-label="Ganpati Bappa sigil">
        <defs>
          <linearGradient id="gstroke" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#c084fc"/>
            <stop offset="1" stop-color="#22d3ee"/>
          </linearGradient>
        </defs>
        <path d="M256 60c-40 4-78 31-96 70-10 22-13 46-10 70 4 34 24 62 52 82 30 22 50 50 56 86 2 10 2 22 1 32-1 5-2 10-2 15m-36-304c-28 10-52 33-62 62-12 34-5 74 19 100 14 15 32 24 51 32m122-133c-7 9-10 17-13 28-10 36 4 78 36 100 11 8 24 12 38 16m-52-178c-9-8-19-12-30-15-9-2-18-3-27-3m-92 328c12 8 30 14 46 15 18 2 36-1 52-9 28-13 48-40 54-70 5-26 1-52-10-76-12-26-34-46-58-60-10-6-22-10-32-15-16-7-30-16-42-28-10-10-18-21-25-34m-36 262c-22 0-40 18-40 40s18 40 40 40 40-18 40-40-18-40-40-40z"/>
        <path d="M378 404c22 0 40 18 40 40s-18 40-40 40-40-18-40-40 18-40 40-40z"/>
        <path d="M238 200c-10-2-20-10-22-20-3-12 6-25 18-28 10-2 20 2 26 10"/>
        <path d="M300 212c8 0 16-4 20-10 6-8 6-20 0-28-4-6-12-10-20-10"/>
      </svg>

      <div class="card pad reveal" style="text-align:center; margin-top:18px">
        <h1>Graha Pravesh & Ganesh Puja</h1>
        <p class="sub">You are warmly invited by <b id="hosts">[HOST NAMES]</b> to bless our new home with your presence.</p>
        <div class="meta">
          <span class="chip" id="date">[DATE]</span>
          <span class="chip" id="time">[TIME WINDOW]</span>
          <span class="chip" id="city">[CITY, STATE]</span>
        </div>
        <div class="scrollhint">Scroll</div>
      </div>
    </div>
  </section>

  <!-- STICKY STAGE -->
  <section class="stage" id="stage">
    <!-- big backdrop that swaps with the face -->
    <div class="stage-bg">
      <img id="stageBg" alt="" />
    </div>

    <div class="pin">
      <!-- rangoli + particles -->
      <div class="floor-wrap"><div class="floor"></div></div>
      <canvas id="particles" class="particles" aria-hidden="true"></canvas>

      <!-- cube -->
      <div class="cube" id="cube">
        <!-- FRONT: Muhurat -->
        <div class="face front">
          <div class="content">
            <div class="art" aria-hidden="true">
              <img class="photo" id="img-front" alt="Muhurat" />
            </div>
            <h3>Shubh Muhurat</h3>
            <p id="muhurat">[MUHURAT WINDOW]</p>
          </div>
        </div>

        <!-- RIGHT: Aarti -->
        <div class="face right" id="aartiFace">
          <div class="content">
            <div class="art" aria-hidden="true">
              <img class="photo" id="img-right" alt="Aarti" />
            </div>
            <h3>Puja â€¢ Aarti</h3>
            <p>Kalash Sthapana â€¢ Sankalpa â€¢ <b>Ganesh Aarti</b> with Modak</p>
          </div>
        </div>

        <!-- BACK: Prasadam -->
        <div class="face back">
          <div class="content">
            <div class="art" aria-hidden="true">
              <img class="photo" id="img-back" alt="Prasadam" />
            </div>
            <h3>Prasadam</h3>
            <p>Satvik vegetarian lunch with sweets & fruits</p>
          </div>
        </div>

        <!-- LEFT: House Blessings -->
        <div class="face left">
          <div class="content">
            <div class="art" aria-hidden="true">
              <img class="photo" id="img-left" alt="House Blessings" />
            </div>
            <h3>House Blessings</h3>
            <p>Dwar Poojan â€¢ House tour â€¢ Family photos</p>
          </div>
        </div>

        <!-- TOP: Parking -->
        <div class="face top">
          <div class="content">
            <div class="art" aria-hidden="true">
              <img class="photo" id="img-top" alt="Parking" />
            </div>
            <h3>Parking</h3>
            <p id="parking">[PARKING / GATE CODE / ELEVATOR]</p>
          </div>
        </div>

        <!-- BOTTOM: Dress Code -->
        <div class="face bottom">
          <div class="content">
            <div class="art" aria-hidden="true">
              <img class="photo" id="img-bottom" alt="Dress Code" />
            </div>
            <h3>Dress Code</h3>
            <p>Traditional / Festive â€¢ saffron, red, gold</p>
          </div>
        </div>
      </div>
    </div>

    <!-- steps -->
    <div class="step" data-face="front"></div>
    <div class="step" data-face="right"></div>
    <div class="step" data-face="back"></div>
    <div class="step" data-face="left"></div>
    <div class="step" data-face="top"></div>
    <div class="step" data-face="bottom"></div>
  </section>

  <!-- VENUE -->
  <section id="venue">
    <div class="inner">
      <div class="card pad reveal">
        <h2 style="margin:0 0 8px 0; font-family:Playfair Display,serif">Venue</h2>
        <div id="address" style="font-weight:600">[FULL ADDRESS LINE]</div>
        <div class="meta">
          <a class="btn" id="maps" href="#" target="_blank" rel="noopener">Open in Maps</a>
          <button class="btn" id="copy">Copy Address</button>
          <a class="btn" id="ics" download>ï¼‹ Add to Calendar (.ics)</a>
        </div>
        <div style="margin-top:12px; color:var(--muted)">Contact: <b id="phone">[HOST PHONE]</b> â€¢ <span id="email">[HOST EMAIL]</span></div>
        <div class="meta" style="margin-top:10px">
          <span class="chip" id="countdown">â€”</span>
        </div>
      </div>
    </div>
  </section>

  <!-- DETAILS -->
  <section id="details">
    <div class="inner">
      <div class="card pad reveal">
        <h2 style="margin:0 0 8px 0; font-family:Playfair Display,serif">Additional Details</h2>
        <div class="meta">
          <span class="chip"><b>Pandit</b>: <span id="priest">[PANDIT â€¢ LANGUAGE]</span></span>
          <span class="chip"><b>Gotra</b>: <span id="gotra">[GOTRA â€¢ FAMILY]</span></span>
          <span class="chip"><b>Notes</b>: <span id="notes">[NO SHOES â€¢ DIYA SAFETY]</span></span>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">SVG icons kept â€¢ Photos on each face â€¢ Scroll-synced backdrop â€¢ Confetti â€¢ Rangoli â€¢ Countdown mm:ss.</footer>

  <audio id="aartiAudio" src="assets/aarti-bells.mp3" preload="auto"></audio>

  <script>
    // ======= CONFIG (edit here) =======
    const CONFIG = {
      title: 'Graha Pravesh & Ganesh Puja',
      hosts: 'Rohit & Family',
      dateISO: '2025-10-12T10:00:00',
      endISO:  '2025-10-12T14:00:00',
      muhurat: '10:00 AM â€“ 12:30 PM',
      timeWindow: 'Puja 10:00 â€¢ Aarti 12:30 â€¢ Lunch follows',
      address: '1234 New Home Ave, Plano, TX 75024',
      city: 'Plano, TX',
      phone: '+1 (555) 012-3456',
      email: 'host@example.com',
      mapQuery: '1234 New Home Ave, Plano, TX 75024',
      whatsapp: 'You are invited to our Graha Pravesh & Ganesh Puja! ðŸª”\nDate: 12 Oct 2025\nTime: 10 AM\nVenue: 1234 New Home Ave, Plano, TX 75024\nJoin us with your blessings.',

      /* FACE PHOTOS â€” replace with your own image URLs */
      faceImages: {
        front:  'muhurat.jpg',     // Muhurat / kalash / clock / sunrise vibe
        right:  'aarti.jpg',       // Aarti / diya / thali
        back:   'modak.jpg',       // Prasadam / modak / sweets
        left:   'house.png',       // House blessings / doorway / toran
        top:    'parking.jpg',     // Parking / building / sign
        bottom: 'dress.webp'    // Dress code / ethnic wear
      },
      /* OUTSIDE BACKDROP per face */
      backdrops: {
        front:  'muhurat-bg.jpg',
        right:  'aarti-bg.jpg',
        back:   'prasadam-bg.jpg',
        left:   'house-bg.jpg',
        top:    'parking-bg.jpg',
        bottom: 'dress-bg.jpg'
      }
    };

    const $ = (s,p=document)=>p.querySelector(s); const $$=(s,p=document)=>[...p.querySelectorAll(s)];

    function fmtDate(iso){ const d=new Date(iso); const o={weekday:'long', year:'numeric', month:'long', day:'numeric'}; return d.toLocaleDateString(undefined,o) }
    function fmtTimeRange(a,b){ const s=new Date(a), e=new Date(b), f={hour:'numeric', minute:'2-digit'}; return `${s.toLocaleTimeString([],f)} â€“ ${e.toLocaleTimeString([],f)}` }
    function makeICS(){ const uid=Math.random().toString(36).slice(2); const dt=d=>new Date(d).toISOString().replace(/[-:]/g,'').replace(/\.\d{3}Z/,'Z'); return `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//GrahaPravesh//Invitation//EN\nBEGIN:VEVENT\nUID:${uid}@inv\nDTSTAMP:${dt(Date.now())}\nDTSTART:${dt(CONFIG.dateISO)}\nDTEND:${dt(CONFIG.endISO)}\nSUMMARY:${CONFIG.title}\nLOCATION:${CONFIG.address}\nDESCRIPTION:${CONFIG.whatsapp}\nEND:VEVENT\nEND:VCALENDAR`; }

    // Populate static text
    document.title = CONFIG.title + ' â€¢ Dark Experience';
    $('#hosts').textContent = CONFIG.hosts;
    $('#date').textContent = fmtDate(CONFIG.dateISO);
    $('#time').textContent = CONFIG.timeWindow || fmtTimeRange(CONFIG.dateISO, CONFIG.endISO);
    $('#city').textContent = CONFIG.city;
    $('#muhurat').textContent = CONFIG.muhurat;
    $('#address').textContent = CONFIG.address;
    $('#phone').textContent = CONFIG.phone; $('#email').textContent = CONFIG.email;

    // Links & countdown (mm:ss only)
    $('#maps').href = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(CONFIG.mapQuery)}`;
    $('#ics').href = URL.createObjectURL(new Blob([makeICS()], {type:'text/calendar'}));
    $('#ics').download = 'graha-pravesh.ics';
    $('#copy').addEventListener('click', async()=>{ try{ await navigator.clipboard.writeText(CONFIG.address); $('#copy').textContent='Copied âœ“'; setTimeout(()=>$('#copy').textContent='Copy Address', 1200);}catch(e){} });
    const countdownEl = $('#countdown');
    function pad(n){ return String(n).padStart(2,'0'); }
    function tick(){
      const ms = new Date(CONFIG.dateISO) - Date.now();
      if(ms<=0){ countdownEl.textContent='Auspicious day has begun!'; return; }
      const totalSec = Math.floor(ms/1000);
      const m = Math.floor(totalSec/60), s = totalSec%60;
      countdownEl.textContent = `${m}m ${pad(s)}s`;
    }
    tick(); setInterval(tick, 1000);

    // Reveal
    const io = new IntersectionObserver(es=>{ es.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target) } }) }, {threshold:.2});
    $$('.reveal').forEach(el=>io.observe(el));

    // Nav dots spy
    const ids=['hero','stage','venue','details'];
    const spy = new IntersectionObserver(es=>{ es.forEach(e=>{ if(e.isIntersecting){ $$('.nav .dot').forEach((a,i)=> a.classList.toggle('active', ids[i]===e.target.id)) } }) }, {rootMargin:'-40% 0% -50% 0%', threshold:0});
    ids.forEach(id=> spy.observe(document.getElementById(id)));

    // steps count
    const steps = $$('.step');
    document.documentElement.style.setProperty('--steps', String(steps.length + 1));

    // cube poses
    const cube = $('#cube');
    const poses = {
      front:  'rotateX(-12deg) rotateY(20deg)',
      right:  'rotateX(-12deg) rotateY(-70deg)',
      back:   'rotateX(-12deg) rotateY(200deg)',
      left:   'rotateX(-12deg) rotateY(110deg)',
      top:    'rotateX(-110deg) rotateY(20deg)',
      bottom: 'rotateX(90deg) rotateY(20deg)'
    };

    // Aarti sound
    const aartiEl = $('#aartiAudio');
    async function playAarti(){
      if(!aartiEl) return;
      try { await aartiEl.play(); }
      catch(err){
        try{
          const ctx = new (window.AudioContext||window.webkitAudioContext)();
          const o = ctx.createOscillator(); const g = ctx.createGain();
          o.type='sine'; o.frequency.value=880; g.gain.setValueAtTime(0.0001, ctx.currentTime);
          o.connect(g); g.connect(ctx.destination); o.start();
          g.gain.exponentialRampToValueAtTime(0.25, ctx.currentTime+0.01);
          g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.7);
          o.stop(ctx.currentTime+0.72);
        }catch(e){}
      }
    }

    // === Photos on faces
    const faceToImgId = {
      front:  'img-front',
      right:  'img-right',
      back:   'img-back',
      left:   'img-left',
      top:    'img-top',
      bottom: 'img-bottom'
    };
    for(const [k,id] of Object.entries(faceToImgId)){
      const el = document.getElementById(id);
      if(el && CONFIG.faceImages[k]) el.src = CONFIG.faceImages[k];
    }

    // === Backdrop swapper
    const stageBg = document.getElementById('stageBg');
    function setBackdrop(face){
      const url = CONFIG.backdrops[face];
      if(!url) return;
      // fade
      stageBg.classList.add('fade');
      const onEnd = ()=>{ stageBg.removeEventListener('transitionend', onEnd); stageBg.src = url; requestAnimationFrame(()=> stageBg.classList.remove('fade')); };
      stageBg.addEventListener('transitionend', onEnd);
      // if image not yet set, set directly
      if(!stageBg.src) { stageBg.src = url; stageBg.classList.remove('fade'); }
    }
    // initial backdrop
    setBackdrop('front');

    // particles
    const pCanvas = document.getElementById('particles');
    const pCtx = pCanvas.getContext('2d');
    let particles = [];
    function resizeParticles(){
      const r = pCanvas.getBoundingClientRect();
      pCanvas.width = Math.ceil(r.width);
      pCanvas.height = Math.ceil(r.height);
    }
    function makeParticle(){
      return { x: Math.random()*pCanvas.width, y: Math.random()*pCanvas.height, z: Math.random()*1.2 + 0.3, vx: (Math.random()-.5)*0.4, vy: (Math.random()-.2)*0.4, life: Math.random()*6+4 };
    }
    function initParticles(n=140){ particles = Array.from({length:n}, makeParticle); }
    function stepParticles(dt){
      pCtx.clearRect(0,0,pCanvas.width,pCanvas.height);
      for(const p of particles){
        p.x += p.vx * (p.z*1.4); p.y += p.vy * (p.z*1.4); p.life -= dt;
        if(p.x< -10 || p.x> pCanvas.width+10 || p.y< -10 || p.y> pCanvas.height+10 || p.life<=0){ Object.assign(p, makeParticle(), { y: -10 }); }
        const r = 1.2*p.z + Math.random()*0.4;
        const g = pCtx.createRadialGradient(p.x,p.y,0,p.x,p.y,r*4);
        const hue = Math.floor(260 + (p.z*80));
        g.addColorStop(0, `hsla(${hue}, 90%, 70%, .9)`);
        g.addColorStop(1, `hsla(${hue}, 90%, 70%, 0)`);
        pCtx.fillStyle = g; pCtx.beginPath(); pCtx.arc(p.x,p.y,r,0,Math.PI*2); pCtx.fill();
      }
    }
    let lastT = performance.now();
    function animateParticles(t){ const dt = Math.min(0.05, (t-lastT)/1000); lastT = t; stepParticles(dt); requestAnimationFrame(animateParticles); }
    const particleObs = new IntersectionObserver(es=>{ es.forEach(e=>{ if(e.isIntersecting){ pCanvas.classList.add('show'); } else { pCanvas.classList.remove('show'); } }) }, {rootMargin:'-45% 0% -45% 0%', threshold:0});
    window.addEventListener('resize', ()=>{ resizeParticles(); initParticles(); });

    // step observer: rotate cube + play aarti + swap backdrop
    const stepObs = new IntersectionObserver(es=>{
      es.forEach(e=>{
        if(e.isIntersecting){
          const face = e.target.dataset.face;
          if(poses[face]) cube.style.transform = poses[face] + ' translateZ(0)';
          if(face==='right') playAarti();
          setBackdrop(face);
        }
      })
    }, {rootMargin:'-45% 0% -45% 0%', threshold:0});
    steps.forEach(s=> stepObs.observe(s));

    // boot particles and backdrop
    requestAnimationFrame(()=>{ resizeParticles(); initParticles(); animateParticles(performance.now()); });
  </script>
</body>
</html>
